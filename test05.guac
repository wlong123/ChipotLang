<< two threads update a ref, uses joins >>
def l = ref [1] in
def t1 = thread (lock l; l := [2]; unlock l) in
def t2 = thread (lock l; l := [3]; unlock l) in
join (t1);
join (t2);
print (!l)